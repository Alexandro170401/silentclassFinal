{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{useNavigate}from'react-router-dom';import{getAuth,onAuthStateChanged}from'firebase/auth';import'./ExamResult.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function ExamResult(){const navigate=useNavigate();const[examResults,setExamResults]=useState([]);const[especialidades,setEspecialidades]=useState({});const[courses,setCourses]=useState([]);const[loading,setLoading]=useState(true);// Fetch especialidades on component mount\nuseEffect(()=>{const fetchEspecialidades=async()=>{try{const response=await fetch(\"http://localhost:8000/especialidades\");if(!response.ok){throw new Error('Failed to fetch especialidades');}const data=await response.json();const especialidadesMap={};data.forEach(especialidad=>{especialidadesMap[especialidad.idespecialidad]=especialidad.especialidad;});setEspecialidades(especialidadesMap);setLoading(false);}catch(error){console.error('Error fetching especialidades:',error);setLoading(false);}};fetchEspecialidades();},[]);// Fetch exam results and courses on authentication state change\nuseEffect(()=>{const fetchExamResults=async user=>{try{const idToken=await getAuth().currentUser.getIdToken();const response=await fetch(\"http://localhost:8000/exam-results\",{method:'GET',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(idToken)}});if(!response.ok){throw new Error('Failed to fetch exam results');}const data=await response.json();console.log(\"Fetched exam results:\",data);// Debugging line\nsetExamResults(data);fetchCoursesForEspecialidades(data);// Fetch courses for exam results\n}catch(error){console.error('Error fetching exam results:',error);}};const unregisterAuthObserver=onAuthStateChanged(getAuth(),user=>{if(!user){// Redirect to login if no user is signed in\nnavigate('/login');}else{// Fetch exam results\nfetchExamResults(user);}});return()=>unregisterAuthObserver();// Clean up Firebase observer\n},[navigate]);// Fetch courses for each idespecialidad in examResults\nconst fetchCoursesForEspecialidades=useCallback(async examResults=>{try{const idespecialidades=examResults.map(result=>result.idespecialidad1);const coursesPromises=idespecialidades.map(idespecialidad=>{return fetch(\"http://localhost:8000/courses/\".concat(idespecialidad),{method:'GET',headers:{'Content-Type':'application/json'}}).then(response=>{if(!response.ok){throw new Error(\"Failed to fetch courses for idespecialidad \".concat(idespecialidad));}return response.json();});});Promise.all(coursesPromises).then(coursesData=>{const courses=coursesData.flat();// Flatten courses array\nconsole.log(\"Fetched courses:\",courses);// Debugging line\nsetCourses(courses);}).catch(error=>{console.error('Error fetching courses:',error);});}catch(error){console.error('Error fetching courses:',error);}},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"exam-result-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Resultados\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"}):/*#__PURE__*/_jsx(_Fragment,{children:examResults.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No current results available.\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"ul\",{children:examResults.map((result,index)=>/*#__PURE__*/_jsxs(\"li\",{className:\"exam-result-item\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"result-especialidad\",children:[result.fecha,\" \"]}),/*#__PURE__*/_jsx(\"span\",{className:\"result-especialidad\",children:especialidades[result.idespecialidad1]}),/*#__PURE__*/_jsxs(\"span\",{className:\"result-score\",children:[\": \",typeof result.nota1==='number'?result.nota1.toFixed(2):'N/A']}),/*#__PURE__*/_jsxs(\"span\",{className:\"result-especialidad\",children:[\" \",especialidades[result.idespecialidad2]]}),/*#__PURE__*/_jsxs(\"span\",{className:\"result-score\",children:[\": \",typeof result.nota2==='number'?result.nota2.toFixed(2):'N/A']}),/*#__PURE__*/_jsxs(\"span\",{className:\"result-especialidad\",children:[\" \",especialidades[result.idespecialidad3]]}),/*#__PURE__*/_jsxs(\"span\",{className:\"result-score\",children:[\": \",typeof result.nota3==='number'?result.nota3.toFixed(2):'N/A']})]},index))}),/*#__PURE__*/_jsx(\"h2\",{children:\"Cursos relacionados\"}),/*#__PURE__*/_jsx(\"ul\",{children:courses.map((course,index)=>/*#__PURE__*/_jsxs(\"li\",{className:\"course-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"course-ncurso\",children:course.ncurso}),/*#__PURE__*/_jsx(\"span\",{className:\"course-descripcion\",children:course.descripcion}),/*#__PURE__*/_jsx(\"span\",{className:\"course-docente\",children:course.nombre_docente})]},index))})]})})]});}export default ExamResult;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useNavigate","getAuth","onAuthStateChanged","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ExamResult","navigate","examResults","setExamResults","especialidades","setEspecialidades","courses","setCourses","loading","setLoading","fetchEspecialidades","response","fetch","ok","Error","data","json","especialidadesMap","forEach","especialidad","idespecialidad","error","console","fetchExamResults","user","idToken","currentUser","getIdToken","method","headers","Authorization","concat","log","fetchCoursesForEspecialidades","unregisterAuthObserver","idespecialidades","map","result","idespecialidad1","coursesPromises","then","Promise","all","coursesData","flat","catch","className","children","length","index","fecha","nota1","toFixed","idespecialidad2","nota2","idespecialidad3","nota3","course","ncurso","descripcion","nombre_docente"],"sources":["C:/Users/HP/Desktop/Proyecto_Alexandro/Version hibrida (local-web)/silent-class/src/components/ExamResult.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { getAuth, onAuthStateChanged } from 'firebase/auth';\r\nimport './ExamResult.css';\r\n\r\nfunction ExamResult() {\r\n  const navigate = useNavigate();\r\n  const [examResults, setExamResults] = useState([]);\r\n  const [especialidades, setEspecialidades] = useState({});\r\n  const [courses, setCourses] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Fetch especialidades on component mount\r\n  useEffect(() => {\r\n    const fetchEspecialidades = async () => {\r\n      try {\r\n        const response = await fetch(`http://localhost:8000/especialidades`);\r\n        if (!response.ok) {\r\n          throw new Error('Failed to fetch especialidades');\r\n        }\r\n        const data = await response.json();\r\n        const especialidadesMap = {};\r\n        data.forEach(especialidad => {\r\n          especialidadesMap[especialidad.idespecialidad] = especialidad.especialidad;\r\n        });\r\n        setEspecialidades(especialidadesMap);\r\n        setLoading(false);\r\n      } catch (error) {\r\n        console.error('Error fetching especialidades:', error);\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchEspecialidades();\r\n  }, []);\r\n\r\n  // Fetch exam results and courses on authentication state change\r\n  useEffect(() => {\r\n    const fetchExamResults = async (user) => {\r\n      try {\r\n        const idToken = await getAuth().currentUser.getIdToken();\r\n        const response = await fetch(`http://localhost:8000/exam-results`, {\r\n          method: 'GET',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            Authorization: `Bearer ${idToken}`,\r\n          },\r\n        });\r\n\r\n        if (!response.ok) {\r\n          throw new Error('Failed to fetch exam results');\r\n        }\r\n\r\n        const data = await response.json();\r\n        console.log(\"Fetched exam results:\", data); // Debugging line\r\n        setExamResults(data);\r\n        fetchCoursesForEspecialidades(data); // Fetch courses for exam results\r\n      } catch (error) {\r\n        console.error('Error fetching exam results:', error);\r\n      }\r\n    };\r\n\r\n    const unregisterAuthObserver = onAuthStateChanged(getAuth(), user => {\r\n      if (!user) {\r\n        // Redirect to login if no user is signed in\r\n        navigate('/login');\r\n      } else {\r\n        // Fetch exam results\r\n        fetchExamResults(user);\r\n      }\r\n    });\r\n\r\n    return () => unregisterAuthObserver(); // Clean up Firebase observer\r\n  }, [navigate]);\r\n\r\n  // Fetch courses for each idespecialidad in examResults\r\n  const fetchCoursesForEspecialidades = useCallback(async (examResults) => {\r\n    try {\r\n      const idespecialidades = examResults.map(result => result.idespecialidad1);\r\n      const coursesPromises = idespecialidades.map(idespecialidad => {\r\n        return fetch(`http://localhost:8000/courses/${idespecialidad}`, {\r\n          method: 'GET',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n        })\r\n        .then(response => {\r\n          if (!response.ok) {\r\n            throw new Error(`Failed to fetch courses for idespecialidad ${idespecialidad}`);\r\n          }\r\n          return response.json();\r\n        });\r\n      });\r\n\r\n      Promise.all(coursesPromises)\r\n        .then(coursesData => {\r\n          const courses = coursesData.flat(); // Flatten courses array\r\n          console.log(\"Fetched courses:\", courses); // Debugging line\r\n          setCourses(courses);\r\n        })\r\n        .catch(error => {\r\n          console.error('Error fetching courses:', error);\r\n        });\r\n    } catch (error) {\r\n      console.error('Error fetching courses:', error);\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"exam-result-container\">\r\n      <h2>Resultados</h2>\r\n      {loading ? (\r\n        <p>Loading...</p>\r\n      ) : (\r\n        <>\r\n          {examResults.length === 0 ? (\r\n            <p>No current results available.</p>\r\n          ) : (\r\n            <>\r\n              <ul>\r\n                {examResults.map((result, index) => (\r\n                  <li key={index} className=\"exam-result-item\">\r\n                    <span className=\"result-especialidad\">{result.fecha} </span>\r\n                    <span className=\"result-especialidad\">{especialidades[result.idespecialidad1]}</span>\r\n                    <span className=\"result-score\">: {typeof result.nota1 === 'number' ? result.nota1.toFixed(2) : 'N/A'}</span>\r\n                    <span className=\"result-especialidad\"> {especialidades[result.idespecialidad2]}</span>\r\n                    <span className=\"result-score\">: {typeof result.nota2 === 'number' ? result.nota2.toFixed(2) : 'N/A'}</span>\r\n                    <span className=\"result-especialidad\"> {especialidades[result.idespecialidad3]}</span>\r\n                    <span className=\"result-score\">: {typeof result.nota3 === 'number' ? result.nota3.toFixed(2) : 'N/A'}</span>\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n\r\n              <h2>Cursos relacionados</h2>\r\n              <ul>\r\n                {courses.map((course, index) => (\r\n                  <li key={index} className=\"course-item\">\r\n                    <span className=\"course-ncurso\">{course.ncurso}</span>\r\n                    <span className=\"course-descripcion\">{course.descripcion}</span>\r\n                    <span className=\"course-docente\">{course.nombre_docente}</span>\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </>\r\n          )}\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ExamResult;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}